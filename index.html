<!DOCTYPE html>
<html lang="es">
<script>
  if(location.protocol === 'http:') {
    location.replace(`https://${location.hostname}${location.pathname}`);
  }
</script>
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon-192x192.png">
<head>
  <script>
  if(window.location.protocol === 'http:') {
    window.location.href = 'https://' + 
      window.location.hostname + 
      window.location.pathname;
  }
</script>
  <meta name="apple-itunes-app" content="app-id=APP_ID">
<meta name="apple-mobile-web-app-capable" content="yes">
  <!-- Compatibilidad Safari -->
<meta name="format-detection" content="telephone=no">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Evitar zoom no deseado -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harmony Hollow</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Paleta de colores pastel */
    :root {
      --p1: #f8c8dc;  /* Rosa pastel */
      --p3: #f5e6e8;  /* Rosa muy claro */
      --accent: #d6a2e8; /* Lila */
      --accent2: #ffb6c1; /* Rosa claro */
      --accent3: #c8a2c8; /* Lila suave */
      --text: #5a3d5c; /* Texto morado oscuro */
      --success: #b5e8c8; /* Verde pastel */
      --flower1: #ffcce6;
      --flower2: #ffb3d9;
      --level-unlocked: #d6a2e8; /* Lila pastel para botones desbloqueados */
      --level-locked: #e0c8f0; /* Lila más claro para bloqueados */
    }

    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    body { 
      background: linear-gradient(135deg, #f9f0ff, #fff0f5);
      font-family: 'Comic Sans MS', 'Nunito', sans-serif; 
      font-size: 14px;
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(var(--flower1) 2px, transparent 2px),
        radial-gradient(var(--flower2) 1px, transparent 1px);
      background-size: 40px 40px;
      background-position: 0 0, 20px 20px;
      opacity: 0.2;
      z-index: -1;
    }
    
    .container { 
      max-width: 100vw; 
      min-height: 100vh;
      margin: 0 auto; 
      padding: 10px;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .floral-decoration {
      position: absolute;
      font-size: 24px;
      color: var(--accent);
      z-index: 0;
      opacity: 0.3;
      pointer-events: none;
    }
    
    .floral-decoration:nth-child(1) { top: 10%; left: 5%; }
    .floral-decoration:nth-child(2) { top: 5%; right: 10%; }
    .floral-decoration:nth-child(3) { bottom: 10%; left: 15%; }
    .floral-decoration:nth-child(4) { bottom: 5%; right: 5%; }

    /* Pantallas */
    .screen { 
      display: none;
      width: 100%;
      max-width: 800px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 25px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 2;
    }
    
    .screen.active { 
      display: flex; 
      flex-direction: column;
      align-items: center;
      animation: fadeIn 0.4s; 
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; transform: translateY(10px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    .center-text { 
      text-align: center; 
    }
    
    .hidden { 
      display: none !important; 
    }
    
    /* Botones */
    .btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
      z-index: 1;
      margin: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 150px;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, var(--accent2), var(--accent3));
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
    }
    
    .btn:hover::before {
      opacity: 1;
    }
    
    .btn i {
      margin-right: 8px;
    }
    
    .btn-large {
      padding: 14px 35px;
      font-size: 1.2rem;
      min-width: 180px;
    }
    
    .btn.back {
      background: #e0c8f0;
      margin-top: 15px;
    }
    
    /* Header */
    #game-header { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      gap: 15px; 
      margin-bottom: 15px;
      width: 100%;
      padding: 10px;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    .avatar { 
      width: 60px; 
      height: 60px; 
      border-radius: 50%; 
      border: 3px solid var(--accent);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .avatar-name { 
      font-weight: bold; 
      font-size: 1.2rem; 
      color: var(--text);
    }
    
    /* Selección de personaje */
    .character-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 20px;
      margin: 20px auto;
      max-width: 600px;
      width: 100%;
    }
    
    .char-card {
      background: white;
      border-radius: 20px;
      padding: 10px;
      border: 3px solid transparent;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .char-card:hover { 
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
    
    .char-card::after {
      content: '';
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      border-radius: 25px;
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .char-card:hover::after {
      opacity: 1;
    }
    
    .char-card img { 
      width: 100%; 
      height: auto; 
      border-radius: 15px;
      aspect-ratio: 1/1;
      object-fit: cover;
    }
    
    .char-card .char-name { 
      margin-top: 8px; 
      font-weight: bold; 
      color: var(--text);
      font-size: 1rem;
      text-align: center;
    }
    
    .char-card.selected { 
      border-color: var(--accent);
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--accent);
    }
    
    .char-card.selected::after {
      background: linear-gradient(45deg, var(--accent2), var(--accent3));
      opacity: 0.3;
    }
    
    /* Menú de niveles */
    .levels {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 25px 0;
      flex-wrap: wrap;
    }
    
    .level-btn {
      background: var(--level-unlocked);
      width: 130px;
      height: 130px;
      border-radius: 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
      color: white;
      font-weight: bold;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    
    .level-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, var(--accent2), var(--accent3));
      z-index: -1;
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .level-btn.unlocked {
      border: 3px solid var(--accent);
      animation: pulse 2s infinite;
    }
    
    .level-btn.newly-unlocked {
      animation: unlock-glow 1.5s ease-out;
    }
    
    .level-btn.locked { 
      background: var(--level-locked) !important; 
      cursor: not-allowed; 
      box-shadow: none; 
      opacity: 0.9; 
    }
    
    .level-btn.unlocked:hover { 
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .level-btn.unlocked:hover::before {
      opacity: 1;
    }
    
    .level-btn i { 
      font-size: 2.5rem; 
      margin-bottom: 10px; 
      color: white;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes unlock-glow {
      0% { box-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px var(--accent), 0 0 40px var(--accent); }
      100% { box-shadow: 0 0 20px var(--accent); }
    }
    
    /* Memotest */
    .memory-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin: 20px;
      max-width: 500px;
    }
    
    .memory-card {
      position: relative;
      width: 80px;
      height: 80px;
      perspective: 600px;
      cursor: pointer;
    }
    
    .card-inner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      transition: transform 0.5s;
      transform-style: preserve-3d;
    }
    
    .memory-card.flipped .card-inner { 
      transform: rotateY(180deg); 
    }
    
    .card-face {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .front {
      transform: rotateY(180deg);
      background-size: cover;
      background-position: center;
      background-color: white;
    }
    
    .back {
      background: linear-gradient(135deg, var(--accent2), var(--accent3));
      color: white;
      font-size: 2rem;
    }
    
    /* Puzzle */
    .puzzle-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 4px;
      width: 300px;
      margin: 20px auto;
    }
    
    .puzzle-piece {
      width: 100%;
      height: 100px;
      position: relative;
      background-size: 300px 300px;
      background-position: center;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, border 0.2s;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }
    
    .puzzle-piece.correct {
      border: 3px solid var(--success);
      cursor: default;
      animation: popIn 0.5s;
    }

    .puzzle-piece.selected {
      border: 3px solid var(--accent);
      box-shadow: 0 0 10px var(--accent);
    }
    
    /* I Spy */
    .ispy-game {
      position: relative;
      width: 100%;
      max-width: 500px;
      height: 300px;
      border: 3px solid var(--accent);
      border-radius: 20px;
      overflow: hidden;
      margin: 20px 0;
      background-color: #f9f0ff;
    }
    
    .ispy-target { 
      font-size: 1.2rem; 
      margin: 15px 0; 
      color: var(--text);
      font-weight: bold;
    }
    
    .ispy-target img { 
      width: 50px; 
      height: 50px; 
      border-radius: 50%; 
      margin-left: 10px;
      border: 2px solid var(--accent);
      vertical-align: middle;
    }
    
    /* Círculo de personajes */
    .circle {
      position: absolute;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2;
      border: 2px dashed var(--accent);
    }
    
    .character-img {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 2px solid white;
      cursor: pointer;
      transition: transform 0.3s, z-index 0.3s;
      z-index: 3;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }
    
    .character-img:hover {
      transform: scale(1.2);
      z-index: 10;
      border-color: var(--accent2);
    }
    
    /* Objetos ocultos */
    .hidden-object {
      position: absolute;
      animation: float 4s ease-in-out infinite;
      z-index: 1;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
      cursor: pointer;
      background: var(--accent3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }
    
    /* Animaciones */
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(5deg); }
    }
    
    @keyframes popIn {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* Felicitaciones */
    .congrats-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .congrats-box {
      background: white;
      padding: 30px;
      border-radius: 25px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      text-align: center;
      max-width: 90%;
      position: relative;
      overflow: hidden;
    }
    
    .congrats-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg, var(--accent2), var(--accent3));
    }
    
    .congrats-box.large { 
      width: 400px;
    }
    
    .congrats-box h2 { 
      font-size: 2rem; 
      margin-bottom: 15px; 
      color: var(--text);
    }
    
    .congrats-box p { 
      font-size: 1.2rem; 
      margin-bottom: 20px; 
      color: var(--text);
    }
    
    h1, h2 {
      color: var(--text);
      margin: 15px 0;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      position: relative;
      display: inline-block;
    }
    
    h1::after, h2::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 3px;
      background: linear-gradient(90deg, var(--accent2), var(--accent3));
      border-radius: 3px;
    }
    
    .large-title {
      font-size: 1.8rem;
    }
    
    .large-text {
      font-size: 1.1rem;
    }
    
    .large-icon {
      font-size: 2.2rem !important;
    }
    
    /* Media queries para móviles */
    @media (max-width: 768px) {
      .levels {
        flex-direction: column;
        align-items: center;
      }
      
      .level-btn {
        width: 120px;
        height: 120px;
        margin: 10px 0;
      }
      
      .character-options {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .memory-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      
      .memory-card {
        width: 70px;
        height: 70px;
      }

      .puzzle-piece {
        height: 80px;
      }
    }

    @media (max-width: 480px) {
      .puzzle-piece {
        height: 70px;
      }
    }
  </style>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎀</text></svg>">
  <!-- SEO Optimization -->
<meta name="description" content="Harmony Hollow: Juegos educativos con diseño pastel">
<meta name="keywords" content="juegos niñas, juegos infantiles, memotest niños, rompecabezas online, i spy juego">
<meta name="author" content="Tu Nombre">
<meta name="robots" content="index, follow">

<!-- Open Graph (para redes sociales) -->
<meta property="og:title" content="Harmony Hollow">
<meta property="og:description" content="Juegos educativos y divertidos con personajes adorables">
<meta property="og:type" content="website">
<meta property="og:url" content="https://tudominio.com">
<meta property="og:image" content="https://tudominio.com/preview.png">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Harmony Hollow">
<meta name="twitter:description" content="Diversión educativa con diseño pastel">
<meta name="twitter:image" content="https://tudominio.com/preview.png">
</head>
<body>
  <!-- Decoraciones florales -->
  <div class="floral-decoration">✿</div>
  <div class="floral-decoration">❀</div>
  <div class="floral-decoration">✾</div>
  <div class="floral-decoration">🌸</div>
  
  <div class="container">
    <!-- SELECCIÓN DE PERSONAJE -->
    <div id="character-select" class="screen active center-text">
      <h1 class="large-title">🌸 Elegí tu personaje 🌸</h1>
      <div class="character-options">
        <div class="char-card" tabindex="0" data-name="Julián">
          <img src="julian.jpeg" alt="Julián"><div class="char-name large-text">Julián</div>
        </div>
        <div class="char-card" tabindex="0" data-name="Julita">
          <img src="julita.jpeg" alt="Julita"><div class="char-name large-text">Julita</div>
        </div>
        <div class="char-card" tabindex="0" data-name="Zinki">
          <img src="sinky.png" alt="Zinki"><div class="char-name large-text">Zinki</div>
        </div>
        <div class="char-card" tabindex="0" data-name="Azu">
          <img src="azu.png" alt="Azu"><div class="char-name large-text">Azu</div>
        </div>
        <div class="char-card" tabindex="0" data-name="Boort">
          <img src="boort.png" alt="Boort"><div class="char-name large-text">Boort</div>
        </div>
        <div class="char-card" tabindex="0" data-name="Cari">
          <img src="cari.png" alt="Cari"><div class="char-name large-text">Cari</div>
        </div>
      </div>
      <button class="btn btn-large" id="start-btn" disabled><i class="fas fa-play"></i> Empezar</button>
    </div>

    <!-- CABECERA -->
    <header id="game-header" class="hidden center-text">
      <img id="avatar-img" class="avatar" src="" alt="Avatar">
      <span id="avatar-name" class="avatar-name large-text"></span>
      <button id="change-char" class="btn btn-large"><i class="fas fa-user-edit"></i> Cambiar</button>
    </header>

    <!-- MENÚ PRINCIPAL -->
    <div id="main-screen" class="screen center-text">
      <h1 class="large-title">🎀 Harmony Hollow 🎀</h1>
      <div class="levels">
        <div class="level-btn unlocked" id="level1-btn">
          <i class="fas fa-brain large-icon"></i><br>Memotest
        </div>
        <div class="level-btn locked" id="level2-btn">
          <i class="fas fa-puzzle-piece large-icon"></i><br>Rompecabezas
        </div>
        <div class="level-btn locked" id="level3-btn">
          <i class="fas fa-search large-icon"></i><br>I Spy
        </div>
      </div>
    </div>

    <!-- MEMOTEST -->
    <div id="memory-screen" class="screen">
      <h2 class="center-text large-title">💖 Memotest</h2>
      <div id="memory-grid" class="memory-grid"></div>
      <button class="btn btn-large back" id="memory-back"><i class="fas fa-arrow-left"></i> Menú</button>
    </div>

    <!-- ROMPECABEZAS -->
    <div id="puzzle-screen" class="screen">
      <h2 class="center-text large-title">🧩 Rompecabezas</h2>
      <div id="puzzle-container" class="puzzle-container"></div>
      <button class="btn btn-large back" id="puzzle-back"><i class="fas fa-arrow-left"></i> Menú</button>
    </div>

    <!-- I SPY -->
    <div id="ispy-screen" class="screen">
      <h2 class="center-text large-title">🔍 I Spy</h2>
      <div id="ispy-target" class="ispy-target center-text large-text"></div>
      <div id="ispy-game" class="ispy-game"></div>
      <button class="btn btn-large back" id="ispy-back"><i class="fas fa-arrow-left"></i> Menú</button>
    </div>

  </div>

  <!-- FELICITACIONES -->
  <div id="memory-congrats" class="congrats-screen hidden">
    <div class="congrats-box large">
      <h2 class="large-title">¡Genial! 🎉</h2>
      <p class="large-text"></p>
      <button class="btn btn-large" id="memory-congrats-btn"><i class="fas fa-check"></i> Continuar</button>
    </div>
  </div>

  <div id="puzzle-congrats" class="congrats-screen hidden">
    <div class="congrats-box large">
      <h2 class="large-title">¡Excelente! 🎉</h2>
      <p class="large-text"></p>
      <button class="btn btn-large" id="puzzle-congrats-btn"><i class="fas fa-check"></i> Continuar</button>
    </div>
  </div>

  <div id="ispy-congrats" class="congrats-screen hidden">
    <div class="congrats-box large">
      <h2 class="large-title">¡Perfecto! 🎉</h2>
      <p class="large-text"></p>
      <button class="btn btn-large" id="ispy-congrats-btn"><i class="fas fa-check"></i> Continuar</button>
    </div>
  </div>

  <script>
    // Personajes + acentos
    const personajes = [
      {name:'Julián', image:'julian.jpeg', accent:'#5890ff'},
      {name:'Julita', image:'julita.jpeg', accent:'#ef6e6e'},
      {name:'Zinki',  image:'sinky.png',  accent:'#b28dff'},
      {name:'Azu',    image:'azu.png',    accent:'#ffc66b'},
      {name:'Boort',  image:'boort.png',  accent:'#ff7b00'},
      {name:'Cari',   image:'cari.png',   accent:'#d0b15b'}
    ];

    // Frases de felicitación
    const frases = [
      "Recordá: cambies lo real por lo aceptado.🩷",
      "Lo mejor que podés ser… es vos.✨",
      "Tu autenticidad es tu superpoder.✨",
      "Ser diferente no es raro, es valiente.🫶🏼",
      "No sos demasiado nada. Sos justo quien tenés que ser.💓",
      "Siempre se fiel a vos misma✨",
      "Ser uno mismo es el primer acto de libertad.🤍",
      "Querete como querés que te quieran.",
      "Merecés lo mejor, empezá por dártelo.",
      "Ser vos no es un error, es un regalo.",
      "Valés incluso en tus días más grises.",
      "Sos suficiente, tal como sos.",
      "Tu voz merece ser escuchada.",
      "Escuchar también es una forma de cuidar.",
      "Podemos pensar distinto y seguir siendo equipo.",
      "Amistad es elegirnos sin condiciones.",
      "Una amistad real no juzga, acompaña.",
      "Lo que te hace diferente, te hace necesario.",
      "La diversidad nos completa.",
      "Nadie queda afuera si el amor está adentro.",
      "Cada paso que damos hacia adentro es libertad."
    ];

    let selectedCharacter = null;
    let selectedPuzzlePiece = null; // Para funcionalidad táctil del puzzle
    
    // Estado persistente durante la sesión
    const gameState = { 
      unlocked: [1] // Nivel 1 siempre desbloqueado
    };

    const screens = {
      select: document.getElementById('character-select'),
      header: document.getElementById('game-header'),
      main:   document.getElementById('main-screen'),
      memory: document.getElementById('memory-screen'),
      puzzle: document.getElementById('puzzle-screen'),
      ispy:   document.getElementById('ispy-screen')
    };

    // Init
    window.addEventListener('DOMContentLoaded', ()=>{
      initCharacterSelect();
      initNav();
      refreshButtons();
    });

    // 1) Selección personaje
    function initCharacterSelect(){
      const cards    = document.querySelectorAll('.char-card');
      const startBtn = document.getElementById('start-btn');
      const avatarImg= document.getElementById('avatar-img');
      const avatarName = document.getElementById('avatar-name');
      const changeBtn = document.getElementById('change-char');

      cards.forEach(card=>{
        card.addEventListener('click', ()=> selectCard(card, cards, startBtn));
        card.addEventListener('keydown', e=>{
          if(e.key==='Enter') selectCard(card, cards, startBtn);
        });
      });

      startBtn.addEventListener('click', ()=>{
        document.documentElement.style.setProperty('--accent', selectedCharacter.accent);
        avatarImg.src = selectedCharacter.image;
        avatarName.textContent = selectedCharacter.name;
        screens.select.classList.remove('active');
        screens.header.classList.remove('hidden');
        screens.main.classList.add('active');
        refreshButtons();
      });

      changeBtn.addEventListener('click', ()=>{
        Object.values(screens).forEach(s=>s.classList.remove('active'));
        screens.select.classList.add('active');
        screens.header.classList.add('hidden');
      });
    }
    
    function selectCard(card, all, btn){
      all.forEach(c=>c.classList.remove('selected'));
      card.classList.add('selected');
      selectedCharacter = personajes.find(p=>p.name===card.dataset.name);
      btn.disabled = false;
    }

    // 2) Navegación y desbloqueo visual
    function initNav(){
      const l1 = document.getElementById('level1-btn');
      const l2 = document.getElementById('level2-btn');
      const l3 = document.getElementById('level3-btn');

      l1.onclick = ()=>{ show('memory'); initMemory(); };
      l2.onclick = ()=>{ if(gameState.unlocked.includes(2)) { show('puzzle'); initPuzzle(); } };
      l3.onclick = ()=>{ if(gameState.unlocked.includes(3)) { show('ispy'); initIspy(); } };

      document.querySelectorAll('.btn.back').forEach(b=>{
        b.onclick=()=> show('main');
      });
      
      // Botones de felicitaciones
      document.getElementById('memory-congrats-btn').onclick = () => {
        document.getElementById('memory-congrats').classList.add('hidden');
        show('main');
      };
      document.getElementById('puzzle-congrats-btn').onclick = () => {
        document.getElementById('puzzle-congrats').classList.add('hidden');
        show('main');
      };
      document.getElementById('ispy-congrats-btn').onclick = () => {
        document.getElementById('ispy-congrats').classList.add('hidden');
        show('main');
      };
    }
    
    function show(name){
      Object.values(screens).forEach(s=>s.classList.remove('active'));
      screens[name].classList.add('active');
      
      if(name === 'main') refreshButtons();
    }

    // Aplicar colores persistentes a los botones desbloqueados
    function refreshButtons(){
      document.querySelectorAll('.level-btn').forEach(btn=>{
        const lvl = +btn.id.slice(-1);
        
        if(gameState.unlocked.includes(lvl)){
          btn.classList.add('unlocked');
          btn.classList.remove('locked');
        } else {
          btn.classList.add('locked');
          btn.classList.remove('unlocked');
        }
      });
    }

    // 3) Memotest – desaparición parejas
    function initMemory(){
      refreshButtons();
      const grid = document.getElementById('memory-grid');
      grid.innerHTML='';
      const imgs = personajes.map(p=>p.image);
      const cards = [...imgs,...imgs];
      shuffle(cards);

      let flipped=false, lock=false, first, second, pairs=imgs.length;

      cards.forEach(url=>{
        const card = document.createElement('div');
        card.className='memory-card';
        card.dataset.img=url;

        const inner = document.createElement('div');
        inner.className='card-inner';
        
        const front = document.createElement('div');
        front.className='card-face front';
        front.style.backgroundImage=`url(${url})`;
        
        const back = document.createElement('div');
        back.className='card-face back';
        back.innerHTML = '❀';
        back.style.backgroundColor = selectedCharacter.accent;

        inner.append(front,back);
        card.append(inner);
        grid.append(card);

        card.addEventListener('click', () => {
          if(lock||card===first) return;
          card.classList.add('flipped');
          if(!flipped){ flipped=true; first=card; return; }
          second=card; check();
        });
      });

      function check(){
        if(first.dataset.img===second.dataset.img){
          lock=true;
          setTimeout(()=>{
            first.remove(); second.remove();
            pairs--;
            if(pairs===0){
              if (!gameState.unlocked.includes(2)) {
                gameState.unlocked.push(2);
              }
              refreshButtons();
              showCongrats('memory');
            }
            reset();
          },400);
        } else {
          lock=true;
          setTimeout(()=>{
            first.classList.remove('flipped');
            second.classList.remove('flipped');
            reset();
          },1000);
        }
      }
      
      function reset(){ flipped=false; lock=false; first=null; second=null; }
    }

    // 4) Puzzle – sistema táctil para móviles
    function initPuzzle(){
      refreshButtons();
      window.puzzleState = [...Array(9).keys()];
      shuffle(window.puzzleState);
      selectedPuzzlePiece = null;
      renderPuzzle();
    }

    function renderPuzzle(){
      const container = document.getElementById('puzzle-container');
      container.innerHTML='';
      
      const containerWidth = container.clientWidth;
      const pieceWidth = containerWidth / 3;
      
      window.puzzleState.forEach((idx,pos)=>{
        const p=document.createElement('div');
        p.className='puzzle-piece';
        p.dataset.idx=idx; 
        p.dataset.pos=pos;
        p.style.backgroundImage=`url(${selectedCharacter.image})`;
        p.style.backgroundPosition=`-${(idx%3)*pieceWidth}px -${Math.floor(idx/3)*pieceWidth}px`;
        p.style.backgroundSize = `${containerWidth}px ${containerWidth}px`;

        if(idx===pos){
          p.classList.add('correct');
        } else if(selectedPuzzlePiece === pos) {
          p.classList.add('selected');
        }

        p.addEventListener('click', () => handlePuzzleClick(pos));
        container.append(p);
      });
    }

    function handlePuzzleClick(pos) {
      const piece = window.puzzleState[pos];
      
      // Si la pieza ya está en su posición, no hacer nada
      if(piece === pos) return;
      
      if(selectedPuzzlePiece === null) {
        // Seleccionar primera pieza
        selectedPuzzlePiece = pos;
        renderPuzzle();
      } else if(selectedPuzzlePiece === pos) {
        // Deseleccionar si se hace clic en la misma pieza
        selectedPuzzlePiece = null;
        renderPuzzle();
      } else {
        // Intercambiar piezas
        const firstPos = selectedPuzzlePiece;
        [window.puzzleState[firstPos], window.puzzleState[pos]] = 
          [window.puzzleState[pos], window.puzzleState[firstPos]];
        
        selectedPuzzlePiece = null;
        renderPuzzle();
        
        // Comprobar si el puzzle está resuelto
        if(window.puzzleState.every((v,i)=>v===i)) {
          if (!gameState.unlocked.includes(3)) {
            gameState.unlocked.push(3);
          }
          refreshButtons();
          setTimeout(()=> showCongrats('puzzle'),300);
        }
      }
    }

    // 5) I Spy – personajes dispersos y ocultos
    function initIspy() {
      refreshButtons();
      const area = document.getElementById('ispy-game');
      area.innerHTML = '';
      
      createHiddenObjects(area, 60);

      const target = selectedCharacter;
      document.getElementById('ispy-target').innerHTML =
        `Encontrá a <strong>${target.name}</strong><img src="${target.image}" alt="">`;
      
      personajes.forEach(p => {
        const img = document.createElement('img');
        img.src = p.image;
        img.alt = p.name;
        img.className = 'character-img';

        const size = 45 + Math.random() * 15;
        img.style.width = `${size}px`;
        img.style.height = `${size}px`;

        img.style.left = `${Math.random() * 90}%`;
        img.style.top = `${Math.random() * 90}%`;
        img.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        img.addEventListener('click', () => {
          if (p.name === target.name) {
            showCongrats('ispy');
          }
        });

        area.appendChild(img);
      });
    }

    function createHiddenObjects(container, count) {
      const symbols = ['❀', '✿', '🌸', '🌺', '🌷', '🌼', '💮', '🏵️'];
      
      for (let i = 0; i < count; i++) {
        const element = document.createElement('div');
        element.className = 'hidden-object';
        element.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
        
        const size = Math.random() * 40 + 30;
        element.style.width = `${size}px`;
        element.style.height = `${size}px`;
        
        const colors = ['#f8c8dc', '#d6a2e8', '#ffb6c1', '#c8a2c8'];
        element.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        element.style.left = `${Math.random() * 90 + 5}%`;
        element.style.top = `${Math.random() * 90 + 5}%`;
        
        element.style.transform = `rotate(${Math.random() * 360}deg)`;
        element.style.animation = `float ${3 + Math.random() * 4}s ease-in-out ${Math.random() * 2}s infinite`;
        
        container.append(element);
      }
    }

    // 6) Felicitaciones - ahora con frases aleatorias
    function showCongrats(mode){
      const congratsElement = document.getElementById(`${mode}-congrats`);
      // Seleccionar un mensaje aleatorio
      const randomIndex = Math.floor(Math.random() * frases.length);
      const fraseAleatoria = frases[randomIndex];

      // Actualizar el texto
      const p = congratsElement.querySelector('.large-text');
      p.textContent = fraseAleatoria;

      congratsElement.classList.remove('hidden');
    }

    // Util barajar
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    }
  </script>
</body>
</html>